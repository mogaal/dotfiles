# Determine OS
if [ "$(uname)" = "Darwin" ]; then
  OS='mac'
elif [ "$(expr substr $(uname -s) 1 5)" = "Linux" ]; then
  OS='linux'
fi

# Architecture: my m1 uses arm and my desktop x86_64. Important because binaries are different
[[ $(uname -m) == arm* ]] && ARCH='arm'
[[ $(uname -m) == x86_64* ]] && ARCH='amd64'

{
  # Compile the completion dump to increase startup speed.
  zcompdump="${ZDOTDIR:-$HOME}/.zcompdump"
  if [[ -s "$zcompdump" && (! -s "${zcompdump}.zwc" || "$zcompdump" -nt "${zcompdump}.zwc") ]]; then
    zcompile "$zcompdump"
  fi
} &!

# Ensure path arrays do not contain duplicates.
typeset -gU cdpath fpath mailpath path

#
# Paths
#

if [ "$OS" = "mac" ]; then
  # set PATH so it includes /usr/local before the regular
  # this will help in MacOS X to use brew's installed version isntead of the
  # outdated on MacOS
  path=(
    /usr/local/{bin/sbin}
    /opt/homebrew/bin
    $path
  )

  if [ -d /usr/texbin ]; then
    path=(
      /usr/texbin
      $path
    )
  fi
fi

# Set the list of directories that Zsh searches for programs.
path=(
  /usr/local/{bin,sbin}
  $path
)

# If there's ~/bin then add it to the path
if [[ -d $HOME/bin/$OS/$ARCH ]]; then
  path=(
    $HOME/bin/$OS/$ARCH
    $path
  );
fi

# If there's ~/gems/bin then add it to the path
if [[ -d $HOME/gems/bin ]]; then
  path=(
    $HOME/gems/bin
    $path
  );
fi

##########
# Golang #
##########

# Custom golang installation
if [[ -d /usr/local/go/bin ]]; then
  path=(
    /usr/local/go/bin
    $path
  );
fi

# If there's ~/bin then add it to the path
if [[ -d $HOME/go/bin ]]; then
  path=(
    $HOME/go/bin
    $path
  );
fi

# TMP files
if [[ ! -d "$TMPDIR" ]]; then
  export TMPDIR="/tmp/$USER";
  mkdir -p -m 700 "$TMPDIR";
fi

if [[ ! -d "$TMPPREFIX" ]]; then
  mkdir -p "$TMPPREFIX";
fi
TMPPREFIX="${TMPDIR%/}/zsh"
